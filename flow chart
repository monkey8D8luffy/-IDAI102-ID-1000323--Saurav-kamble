graph TD
    A[Start] --> B{Load Data};
    B -- Success --> C[Initialize Session State];
    B -- Failure --> D[Load Default Data];
    D --> C;
    C --> E[Display Dashboard Tab];

    subgraph "User Interaction & Data Processing"
        E --> F[User Inputs Purchase Details\n(Product, Brand, Price)];
        F --> G{Is there an Eco-Suggestion?};
        G -- Yes --> H[Display Eco-Tip];
        G -- No --> I;
        H --> I{Click "Add to Tracker"?};
        I -- Yes --> J[Calculate CO2 Impact & Create Record];
        I -- No --> F;
        J --> K[Append to Session State Purchases];
        K --> L[Save Data to JSON];
        L --> M[Check for New Badges];
        M --> N{New Badge Earned?};
        N -- Yes --> O[Update Profile Badges & Show Toast Notification];
        N -- No --> P;
        O --> P;
        P --> Q{Is it an Eco-Friendly Purchase?};
        Q -- Yes --> R[Trigger Green Leaf Animation];
        Q -- No --> S[Trigger Dry Leaf Animation];
        R --> T[Update Dashboard Metrics & Recent Activity];
        S --> T;
        T --> E;
    end

    subgraph "Analytics & Profile"
        E -- Switch Tab --> U[Display Analytics Tab];
        U --> V[Read Session State Data];
        V --> W[Generate & Display Plotly Charts];
        W --> E;

        E -- Switch Tab --> X[Display Profile Tab];
        X --> Y{Update Settings or Reset?};
        Y -- Update Settings --> Z[Update User Profile in Session State];
        Z --> L;
        Y -- Reset Data --> AA[Clear Session Purchases & Badges];
        AA --> L;
    end
